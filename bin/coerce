#!/usr/bin/env node

/**
 *  Example of coercing argument values.
 *
 *  ./bin/coerce -i 10 -f 3.14 --range 1..10 -o=10 --list=apples,oranges file.txt
 */
var path = require('path');
require('ttycolor')().defaults();
var pkg = path.normalize(path.join(__dirname, '..', 'package.json'));
var cli = require('..')(pkg);

function range(val) {
  return val.split('..').map(Number);
}

function list(val) {
  return val.split(',');
}

cli
  .usage('[options] <file ...>')
  .option('-i, --integer <n>', 'an integer argument', parseInt)
  .option('-f, --float <n>', 'a float argument', parseFloat)
  .option('-r, --range <a>..<b>', 'a range', range)
  .option('-l, --list <items>', 'a list', list)
  .option('-o, --optional [value]', 'an optional value')
  .on('run', function() {
    //console.log(JSON.stringify(this));
    for(var key in this) {
      console.log(key + ': %s (%s)', this[key],
        Array.isArray(this[key]) ? 'array' : typeof(this[key]));
    }
    var args = this.request().args;
    if(args && args.length) {
      console.log('args: %s', args.join(', '));
    }
  })
  .version()
  .help()
  .parse();
