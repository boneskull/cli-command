#!/usr/bin/env node

/**
 *  Example program to test custom version output.
 *
 *  ./bin/version/custom
 *  ./bin/version/custom -h
 *  ./bin/version/custom --help
 */
var os = require('os');
var path = require('path');
require('ttycolor')().defaults();
var pkg = path.normalize(path.join(__dirname, '..', '..', 'package.json'));
var cli = require('../..');
var version = cli.version;
cli = cli(pkg, 'version/custom');
var repeat = require('cli-util').repeat;
cli
  .description('Test program for custom version')
  .version(function() {
    var user = process.env.USER;
    version.call(this, true, os.type() +
      ' (' + process.arch + ') ' +
      (user ? user + '@' + os.hostname() : os.hostname()));
    var keys = Object.keys(process.versions), key;
    keys.sort();
    for(var i = 0;i < keys.length;i++) {
      key = keys[i];
      console.log(repeat() + '+' + key + ' %s', process.versions[key]);
    }
    keys = [
      'clang', 'gcc_version', 'host_arch', 'node_use_openssl',
      'node_use_dtrace', 'v8_enable_gdbjit', 'v8_no_strict_aliasing',
      'v8_use_snapshot'
    ];
    keys.forEach(function(key) {
      console.log(repeat() + '+' + key + ' %s', process.config.variables[key]);
    })
    process.exit();
  })
  .help()
  .on('empty',function(help, version) {
    // invoke our custom version logic
    // when zero arguments are present
    version.call(this);
  })
  .parse();
